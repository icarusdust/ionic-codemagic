 workflows:
    ionic-capacitor-android-workflow:
          name: Ionic Capacitor Android Workflow
          max_build_duration: 120
          instance_type: linux_x2
          environment:
              vars:
                # Android Keystore environment variables
                CM_KEYSTORE: Encrypted(Z0FBQUFBQmcwZXVJV2pWRkp6Y2luTTNZMVpFSl9PVDlpVGtGU2tkdmpFY0FYQWdaYnF5UjJUXzk5MmNpSjRsTzc3azNuU1VGVURaOHVtaGx1LWJFSHBVX2Z4UkUxNGF1NU03QTVQdXE3OE1PU2NGRHZKUWhIODV3UnZzVG51Nk9tRTJITXdERDN3TEZ3dndqa3pQRm5wcERDaVdLSW5hVHoxTnhJLTVNU3VUdFN1ZVBDRFE5NkdWNTg3Y2Y0T3ZxQ3ljR2JRemZNWW5wOHFiUHp4MXk0dHM3WmZrSXFMWjdNampNUnVQdE5qYzVSdkpmZEloQmZEWkFNVUZtSEttTjRIM2xpOFdKVmdGeGtqSnhUaXZUNTVrZk1VRlBocHRtcnRTRklBYXVQV0ItT1hVcVdCU0w3YXNZWkhxVk9xOFhaSmQ1TVdfQ185YnZBM3IweTJLajNKc2xwQ01YWURZUUt5eWxqNmtGNTRwaEI3TkRfeVBVZmc2aGRTTHFNRmM0WEdqdTdRN05tb1Q4QTZGdHQzTzBBcVp5SkxMYjFrZXVSQURQcFItcTdZSzgzMjBac3FxVzZKZ2hQUUpIRUNDcm1UWUs1SFUxWnVJUmFqejdwTklUNFZKbmJKZk9jQW9vc1hjNkg2NUEtdUVEX1hVSVgyX2w4THZhcFNyY0NUdThSOE5QMUpCTEpFLWxBSEo1aDRJQUVraFZ1S2w2ZnBLMEVSZzhDN0RkdHQ5RTFrcEt1XzIxXzdLcTZmdW9jNDl6Q1pZS29jSE9zQmRGd1pzRzZsbzVENlF6NDViWnFZRWFzWG5NMVUtbXUyZVY5T2JsbV8yMXFlc3VYSklKVm1VV0diTldOeHdIYkxQemVUb2NDUFRXQWFkbDRtamk4b2NMb1Q3TFBqLUhkYXgwbTRXZ2xzNGRYbnRFWTdzYkMtaDE5T0VUNXRZakUxUFcycXpzRFo5QWRKSmRWa0tpUlV6b2s5WHVfUTV4OFFaM25XSlA4Mktra0lFUkJLa3lPWTdWSWIweWRxRDFLcjY2YTVxNlFrMDJseE5VdHhnYkptc0ViTS1SRDd1OFNEUWhFZ3E0V2o2T0wzMmdOTVhfRl9LOC1PRWZrNTBGQTVUX2pkU1ZnNGtJUmI1WGpyclRkWERtc3JVQUZrbXVqaXhQcW1sYUNFRVVmcTk4UjdBQWRLeU5mZ3FyQUpBalV1eUw1S01KZ1FXMVpHUmNXTWVWaE45TUk0cEZyMWZiTWR1U2xZdmF4NV9pLWlUN0FIT2piZjZwNG9ubkFXdXllVGFnYmxxcm9KQ3RGelB5Vm9DaTBIX09Jb0FwYTMxX2R2OEt6ZWdIWU5kdzBPZUhGQVNaVUV1V0pReno1MlBOTkRrRGNzLWhPdTEyQU9XeHV2LVBNWDhSRWpURHRLdFdZX04ycHJHYTRndGtpaVBaRWQ0VW5xYTVaV3ZsTkJ3ZDQxc25wZnlITXpEdlBSc2Fkc2E3ZXZ2c2p6UmthNjdfQUw5TmtSTTVyek1tZ01wOWNnNkY5cVNZSzRFMWQxalhnZ1plSENhWmEyQUlXNC15VmUxWFpvZ1ZTdXQ4b1VTWTlvSEprenE4Z0F5OEV5N2YxTnlVaVRvOExYQ2lCTllOSmlpR1RrOHFCSmE0WEFRVVpGSXNJM2dUVGpuakwzb3liX2g1V001WXdaSkkwOWplTDJwMDE3WnF0bGlUREJWQ0phNU5FSjVCblBhdVotRndoTW1JVWZWQ2VvbjZNeWhpM21DS2tDR1NtSEZ0WFFtUXdVcUNxN01tZE9jLVVURF94ekZ4dGVEQm42NHlRRVAwbWdvS1BGRDlYUTJVMDF0ZGJkUDV1bmRjcGpTbkRpaXl2ZTMyam1jYUxYczA2ZExiQl9fejBhUm8zRnQwNW01RjZ4a0U2QmZoWkRvQnlITFptT0I0VTh2MzZZSklicG5vVzFkNlAyMTV1Si1NOHNPSVpvWkxITzVYNFNWcUtRc1Uwc0lmTXV0Y3NzU0V2TG5HWXIwaHdWRjBqVngtZmppRlZONnBWTVItMXZsVk02UVMxcWxzOVljbVljMEt4WHJBTUJBbkRKQVNlYUNEMmZYNHhsMHVrVi0zZWRKX0dZakE1MVRSQTd0VVoxRUU1WVoyXzB4TmR0WThkX2RsRVQtSGl3OW9qbE5objFnYW1XX0ZuSTRMSkNhV2l0Mkc2cGVJTV9YRENJc1JxQkFZRFVxT0hmM0RPU2NVT2FDY1RYemtLVUhCeEQ1VkMzRGd0aUNuSGdMOEU2RjRiYWZwSmxaeFA3dFI4UDJEYnVFRXpaSkNYam5rRTM1RmJpWmNDa2pCNWZMMGJWNWlPVUVZWHBUS0daNHBwZ3dHMlhITXlrZ0dhSzRDd0ZERHpuOGtRMXBqa3ZMYjVmZFFJaGU3ZGFHNXVXcm9odmZEVW5CRmx1c0h2M29zalk5QXVHZ0cxTU92dXBSa3VWemU1dFBwSVlzaE83ckJYdDIxbU9xWF9zX1lxblpZM0FwaGxPeUtlbXZWX2c3XzlDSTg5NVM3bDVtZ3ZLSm1NaEp5ZktLR1g4aDh4bDlzS1pWV05UQWc5Y0lueXpOOHpieV96Y21weGRLLVN3ZFBHb2t5RXM2cTN5MzNfRmphcGJTdk9PbnR5ZTc4SWh1aE9xZ0xYdDA0VmdWWGM0NkU0eDhfQWloTHJHeVR6djJOZDA4Tm9wMmc1VDlHVlBZMDdrTjBMSmdLM19kVHgxNnYxc1k1UVhseTNNVzdGVGRBM195elZhUFNDSmJVd3VfclFpZTNIS0Frd2dMRDVYQzdNdmxLWjdBRDRlSkpfdlFhaGZhcTFWY09tNU51S252ek9ZdmRsbkg4eEpUcW9Lb21PSkVBLThuaXZzem0yQU5tS2hPc0pxWnJ0eW13c0dEYXdwTVYtT2FRVS04YnRDNXduWjdvUzU0cVBvdEhnSXUybWd2bHVlbGxqaUZjUGExdVRrR08tb3RtQWFiYlIxNXpEcGtrVmJBQW9Ca3E1NVBaYkRTeElFNUpHcThHVDFiNzQ0bmdKaFhmZmZpY3RJNTdJZk1CcnFiMFdxamN3LXAyMGRvQjZpbjd5TXltRFBNcDg5dU9PX0R2LU84bVpLUVl4ZUs4TTgyYlpfQlI3ckpnTl9HQ2pnbGpkVmpQQVd6NFR1aHJLRDJaQ2pZRzdETmh6SUV6TXpOU2E0RmN6X3hlRHdha19OZ0VaNEh6ZDBhZU1GTEN5SlNLMzg4NFlFWC1BV1luNXNVdjhCTFcyNFhnQUpxQ09CbTJwOTFoYWI3MERqM0tMQ0U5SzZqSDlNNXBVQVRiNVpjdVM4Tk84VVQxYU1mZ1pkb2NYTmItcC1LYmhqejVnekhPc2dnUmlRa0NVYmR5cFhQRHFZUTJRb1BUWWVxdVFrUkdXQ0hmcDVXNWpleHFLRFRlUkZpUUhtR2xkRmw4akRsazBicHZ4ZkFLcFZKaGZmdnpMZlpRRXRMbEsxTVM5cmRZTVlJSHBmRFRyOVJUYTh1djZKaHdvYUJDaDVvTHE1OFcxVzN1YnA5R0VJLURyWlp1Q3dsYjJvOWNnZEFlbU5QM0lzWU91Mlc5SG9kODhNQUJKTHlhZ21pTmJZLXAtU1JkeXBHbHR1bTNXSDM2dDZuVnBSTDVkTFlpTG8tQnRQMTkxbU1nRm9FTGNoQ29QS1hpak05azFZNEpUMUhTQnNJOHpaeS1WMzNzYmZqbFI0ZXdGUTFwTWV0YkY0ajI3cVV6TkQ3NkhaVkp5ZjBsVXdLMXRYTDV1RjZxQnBiMEkzVWs3RGRmY1V0UEQxaU9hOGdFalpCclJEZFpSbzFrZ0IzdkZuZlM2M1k5VDVySEZMWlhiYlRjZi1FM2FpQ1RtT000aXhzc3V3dTVsRFZ6MU9QOUdzLTBwUGRsanlyMGRFNUZzVlloWldtSnpYLUoyYlJIMFY4NWgzUkhxa01OVW9XSmNGcWhKM0QzVlRHdVZGWDc3clJPM3FlbkxqbTVWdnJlQjBrUjQ4dFdrdUhfTGFWLUVyRHhXbDQ1STBtQ0MyWE1MY0tfRzZUUTJLMFkzbUN5ZUh5ZTdWcXFwcHZqdTVVUkVteEZuZXRlb3dLcE95ZjZEb1o5SkNTZWxRQTFsRTV3TzRZOUFRcE1wb013d2ZvWDBjeXk0NV9XMk1yNTNlekd3eWl1Tlg4VVE4YVJVdGpmTmxfejYzN053ZVhqNnk1M2x3NkUzazdzcFlNcms1RnFRMmdTdGNoVzBzNU9WUWhpNkRxN3JKbTFSMXJGOXJ3UDBiZmFjTXE4VVBnT1BQNzM3Y0JNS0oteHpmREpuUTE0VU9MSXFaZXJXNk5jeFZWaHk4dVA4c0U5WlJrR2V6ZE5aa2l3MS1HdTFvVHctNWFGM19NZ2FtMG5rRldxZG1Kc04yellGVExsaWpWdVNQZ29mR0g4cmF0SXltU1VfSmdDQm5tVnAtTDFyZjh5elRNMTN6dG13eEZqaThRd19QRDEyY1pWN3J5dFRMaG1uQmFxU2s3ZzdpZFl1cWZBc3F1MFRuMEtDcmFENDRwbzZjR3JoMEtycDJiTExJYk8tMW9mRS1rS2U3eFVBLVpreVA4SWtROFhmdzI3N2FNekIycnh0RHpXUVlRNThGNHZOSjZYd3BiazJMUWtRY1ZlRXk3aDRFMS1mS0lZY3BYOUl1YW9FYmhVcDE5VTNKc2tRNmVtZXJMLUR1cC1SN1NwZzlWeThkdWpGdEk0aTZVbFkzRzR3OUdMSndvTDZlQXJDOVlqQ0JzVUFfQVd1YWNwNFZobTg0N0hYMlRYNzhiLTVnY0ZtdXN4eWxPY08tdlltcjZOTVlYYzBFMFpidDN2Rm1Mb0xDdDlIU3N6OVU3cXVUVVBNejJqUGpoMlRvSEZJWW9NNU4tTkM3Q2VQbC1COGE5N3VBdGxUMk5ValpCT2RtZ3RRZTFyNEtTU3U1LVBTUE9Ub2pKS0N4QUhGRjVWNmtrWFl3TFBOa1JUd0NqSnJocGZjZV9HdmZyV0FEUVBRQU13d0xDb0YzdHI5TnBzcFJST05qRE1OTFJGSkJvZkVSZkszOUtBbDFPV0pEZnBqQWVUaFBHZ2F3MXk4V1lvVER1UkxQaEFpUWl6dnpFSlBWeGVKenRsZ09jMERSTXhCaFNOc1RqRGN5M1hLYl92bmZhM0tpN202ZndHWUc1U0NVU3J1NXFGNW5ZcWVuWXhLT3hHa0VtQWlIMHk2OHgxazdNMHVxUmN0RGN2aXBjMjlLbkl0MTJjU1J6LUd6ajlac0xJS2FZYldqckxKdmlYV3FkMlJaX3BmekZaaTk1MVZEZFdBakxuV1pJYVhIZFZvZno4eEJTWmV0WFNhcHdLaEdyeDFLOC1jTExCZDZfN05QeFR0VUlFcktQdll3czFPcXZtSWVRZGdfQTV3MWVxVWtyN1F3WT0=) # <-- Put your encrypted keystore file here
                CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmcwZXRMTFJQcExnaG13THV5enRaazREbG9BcU9PVktYNU1WTG1CeE4tTjdzOGZSWlpscWxTVmNybEFfdHdrenc5V3dfZXVwNVZiSks4dEVadzM1dG5FaG5udmc9PQ==) # <-- Put your encrypted keystore password here
                CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmcwZXRMTFJQcExnaG13THV5enRaazREbG9BcU9PVktYNU1WTG1CeE4tTjdzOGZSWlpscWxTVmNybEFfdHdrenc5V3dfZXVwNVZiSks4dEVadzM1dG5FaG5udmc9PQ==) # <-- Put your encrypted keystore alias password here
                CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmcwZXR1RXNmYWVBdlBWOVhiRTlUTXJaZ2lUODNxbTF2ZGpIUnk4WFozYl96THFjZElzQTIzUGJ0cHBTUFlGdUs1WGJLa3F3bHNlQV9TUGlJcExMX1F3SkpDcUE9PQ==) # <-- Put your encrypted keystore alias username here
              node: latest
          triggering:
              events:
                  - push
                  - tag
                  - pull_request
              branch_patterns:
                  - pattern: develop
                    include: true
                    source: true
          scripts:
              - name: Install npm dependencies for Ionic project
                script: |
                  npm install
              - name: Set Android SDK location
                script: |
                  echo "sdk.dir=$ANDROID_SDK_ROOT" > "$FCI_BUILD_DIR/android/local.properties"
              - name: Set up keystore
                script: |
                  echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
                  cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
                  storePassword=$CM_KEYSTORE_PASSWORD
                  keyPassword=$CM_KEY_ALIAS_PASSWORD
                  keyAlias=$CM_KEY_ALIAS_USERNAME
                  storeFile=/tmp/keystore.keystore
                  EOF
              - name: Update dependencies and copy web assets to native project
                script: |
                  # npx cap copy # <- use this is you don't need to update native dependencies
                  npx cap sync # <- update native dependencies and copy web assets to native project
              - name: Build Android release
                script: |
                  cd android
                  ./gradlew assembleRelease
          artifacts:
              - android/app/build/outputs/**/*.apk
          publishing:
              email:
                  recipients:
                      - nihal@nevercode.io
                  notify:
                    success: true     # To not receive a notification when a build succeeds
                    failure: false     # To not receive a notification when a build fails
